<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Magic Link - VineWatch</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: #111827;
            color: white;
        }
        .container {
            background-color: #1F2937;
            padding: 30px;
            border-radius: 10px;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #374151;
            border-radius: 5px;
            background-color: #374151;
            color: white;
        }
        button {
            background-color: #722F37;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #8B3A42;
        }
        .message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background-color: #065F46; }
        .error { background-color: #7F1D1D; }
        .warning { background-color: #92400E; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Magic Link</h1>
        <p>Prueba simplificada del Magic Link</p>
        
        <div>
            <input type="email" id="email-input" placeholder="Ingresa tu email" value="franciscocaucar@gmail.com">
            <button id="test-btn">üöÄ Probar Magic Link</button>
        </div>
        
        <div id="message"></div>
        
        <div id="debug" style="margin-top: 20px; font-family: monospace; font-size: 12px; background-color: #000; padding: 10px; border-radius: 5px;">
            <strong>Debug Info:</strong><br>
            <div id="debug-content">Cargando...</div>
        </div>
    </div>

    <script>
        // Configurar variables de entorno para Supabase
        window.VITE_SUPABASE_URL = 'https://agesojhoiemujyokbyin.supabase.co'
        window.VITE_SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFnZXNvamhvaWVtdWp5b2tieWluIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4NTczMTEsImV4cCI6MjA3NDQzMzMxMX0.03CwWaoXbWJINCE7nzLV4dwSJhvlSu9kC8S-V5VCXJo'

        let supabase = null

        async function initSupabase() {
            try {
                const { createClient } = await import('https://cdn.skypack.dev/@supabase/supabase-js@2')
                
                supabase = createClient(
                    window.VITE_SUPABASE_URL,
                    window.VITE_SUPABASE_ANON_KEY,
                    {
                        auth: {
                            redirectTo: 'https://vinewatch.streamlit.app'
                        }
                    }
                )
                
                updateDebug('‚úÖ Supabase inicializado correctamente')
                return true
            } catch (error) {
                updateDebug('‚ùå Error al inicializar Supabase: ' + error.message)
                return false
            }
        }

        async function sendMagicLink() {
            const email = document.getElementById('email-input').value.trim()
            
            if (!email) {
                showMessage('Por favor, ingresa tu email', 'warning')
                return
            }

            if (!supabase) {
                showMessage('Supabase no est√° inicializado', 'error')
                return
            }

            updateDebug('üìß Enviando Magic Link a: ' + email)
            
            try {
                const { error } = await supabase.auth.signInWithOtp({
                    email: email,
                    options: {
                        emailRedirectTo: 'https://vinewatch.streamlit.app'
                    }
                })
                
                if (error) {
                    updateDebug('‚ùå Error: ' + error.message)
                    showMessage('Error: ' + error.message, 'error')
                } else {
                    updateDebug('‚úÖ Magic Link enviado exitosamente')
                    showMessage('¬°Magic Link enviado! Revisa tu email.', 'success')
                }
            } catch (error) {
                updateDebug('‚ùå Error inesperado: ' + error.message)
                showMessage('Error inesperado: ' + error.message, 'error')
            }
        }

        function showMessage(text, type) {
            const messageDiv = document.getElementById('message')
            messageDiv.innerHTML = `<div class="message ${type}">${text}</div>`
        }

        function updateDebug(text) {
            const debugDiv = document.getElementById('debug-content')
            debugDiv.innerHTML += text + '<br>'
        }

        // Inicializar cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', async function() {
            updateDebug('üîÑ Inicializando...')
            
            const success = await initSupabase()
            
            if (success) {
                document.getElementById('test-btn').addEventListener('click', sendMagicLink)
                updateDebug('‚úÖ Listo para probar')
            } else {
                updateDebug('‚ùå No se pudo inicializar')
            }
        })
    </script>
</body>
</html>
